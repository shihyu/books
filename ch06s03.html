<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>3. for語句</title><link rel="stylesheet" href="styles.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.73.2" /><link rel="start" href="index.html" title="Linux C編程一站式學習" /><link rel="up" href="ch06.html" title="第 6 章 循環語句" /><link rel="prev" href="ch06s02.html" title="2. do/while語句" /><link rel="next" href="ch06s04.html" title="4. break和continue語句" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">3. for語句</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch06s02.html">上一頁</a> </td><th width="60%" align="center">第 6 章 循環語句</th><td width="20%" align="right"> <a accesskey="n" href="ch06s04.html">下一頁</a></td></tr></table><hr /></div><div class="sect1" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2726720"></a>3. for語句</h2></div></div></div><p>前兩節我們在<code class="literal">while</code>和<code class="literal">do/while</code>循環中使用循環變數，其實使用循環變數最見的是<code class="literal">for</code>循環這種形式。<code class="literal">for</code>語句的語法是：</p><div class="literallayout"><p>for (控製表達式1; 控製表達式2; 控製表達式3) 語句</p></div><p>如果不考慮循環體中包含<code class="literal">continue</code>語句的情況（稍後介紹<code class="literal">continue</code>語句），這個<code class="literal">for</code>循環等價于下面的<code class="literal">while</code>循環：</p><pre class="programlisting">控製表達式1;
while (控製表達式2) {
	語句
	控製表達式3;
}</pre><p>從這種等價形式來看，控製表達式1和3都可以為空，但控製表達式2是必不可少的，例如<code class="literal">for (;1;) {...}</code>等價于<code class="literal">while (1) {...}</code>死循環。C語言規定，如果控製表達式2為空，則認為控製表達式2的值為真，因此死循環也可以寫成<code class="literal">for (;;) {...}</code>。</p><p>上一節<code class="literal">do/while</code>循環的例子可以改寫成<code class="literal">for</code>循環：</p><pre class="programlisting">int factorial(int n)
{
	int result = 1;
	int i;
	for(i = 1; i &lt;= n; ++i)
		result = result * i;
	return result;
}</pre><p>其中<code class="literal">++i</code>這個表達式相當於<code class="literal">i = i + 1</code><sup>[<a id="id2726856" href="#ftn.id2726856" class="footnote">9</a>]</sup>，++稱為首碼自增運算符（Prefix Increment Operator）<a id="id2726869" class="indexterm"></a>，類似地，--稱為首碼自減運算符（Prefix Decrement Operator）<a id="id2726877" class="indexterm"></a><sup>[<a id="id2726883" href="#ftn.id2726883" class="footnote">10</a>]</sup>，<code class="literal">--i</code>相當於<code class="literal">i = i - 1</code>。如果把<code class="literal">++i</code>這個表達式看作一個函數調用，除了傳入一個參數返回一個值（等於參數值加1）之外，還產生一個Side Effect，就是把變數<code class="literal">i</code>的值增加了1。</p><p><code class="literal">++</code>和<code class="literal">--</code>運算符也可以用在變數後面，例如<code class="literal">i++</code>和<code class="literal">i--</code>，為了和首碼運算符區別，這兩個運算符稱為尾碼自增運算符（Postfix Increment Operator）<a id="id2726952" class="indexterm"></a>和尾碼自減運算符（Postfix Decrement Operator）<a id="id2726960" class="indexterm"></a>。如果把<code class="literal">i++</code>這個表達式看作一個函數調用，傳入一個參數返回一個值，返回值就等於參數值（而不是參數值加1），此外也產生一個Side Effect，就是把變數<code class="literal">i</code>的值增加了1，它和<code class="literal">++i</code>的區別就在於返回值不同。同理，<code class="literal">--i</code>返回減1之後的值，而<code class="literal">i--</code>返回減1之前的值，但這兩個表達式都產生同樣的Side Effect，就是把變數<code class="literal">i</code>的值減了1。</p><p>使用++、--運算符會使程序更加簡潔，但也會影響程序的可讀性，<a class="xref" href="bi01.html#bibli.kr" title="The C Programming Language">[<abbr class="abbrev">K&amp;R</abbr>]</a>中的示例代碼大量運用++、--和其它表達式的組合使得代碼非常簡潔。為了讓初學者循序漸進，在接下來的幾章中++、--運算符總是單獨組成一個表達式而不跟其它表達式組合，從<a class="xref" href="ch11.html#sortsearch">第 11 章 <i>排序與查找</i></a>開始將採用<a class="xref" href="bi01.html#bibli.kr" title="The C Programming Language">[<abbr class="abbrev">K&amp;R</abbr>]</a>的簡潔風格。</p><p>我們看一個有意思的問題：<code class="literal">a+++++b</code>這個表達式如何理解？應該理解成<code class="literal">a++ ++ +b</code>還是<code class="literal">a++ + ++b</code>，還是<code class="literal">a + ++ ++b</code>呢？應該按第一種方式理解。編譯的過程分為詞法解析和語法解析兩個階段，在詞法解析階段，編譯器總是從前到後找最長的合法Token。把這個表達式從前到後解析，變數名<code class="literal">a</code>是一個Token，<code class="literal">a</code>後面有兩個以上的+號，在C語言中一個+號是合法的Token（可以是加法運算符或正號），兩個+號也是合法的Token（可以是自增運算符），根據最長匹配原則，編譯器絶不會止步于一個+號，而一定會把兩個+號當作一個Token。再往後解析仍然有兩個以上的+號，所以又是一個++運算符。再往後解析只剩一個+號了，是加法運算符。再往後解析是變數名<code class="literal">b</code>。詞法解析之後進入下一階段語法解析，<code class="literal">a</code>是一個表達式，表達式++還是表達式，表達式再++還是表達式，表達式再+b還是表達式，語法上沒有問題。最後編譯器會做一些基本的語義分析，這時就有問題了，++運算符要求操作數能做左值，<code class="literal">a</code>能做左值所以<code class="literal">a++</code>沒問題，但表達式<code class="literal">a++</code>的值只能做右值，不能再++了，所以最終編譯器會報錯。</p><p>C99規定了一種新的<code class="literal">for</code>循環語法，在控製表達式1的位置可以有變數定義。例如上例的循環變數<code class="literal">i</code>可以只在<code class="literal">for</code>循環中定義：</p><pre class="programlisting">int factorial(int n)
{
	int result = 1;
	for(int i = 1; i &lt;= n; i++)
		result = result * i;
	return result;
}</pre><p>如果這樣定義，那麼變數<code class="literal">i</code>只是<code class="literal">for</code>循環中的局部變數而不是整個函數的局部變數，相當於<a class="xref" href="ch04s01.html#cond.if">第 1 節 “if語句”</a>講過的語句塊中的局部變數，在循環結束後就不能再使用<code class="literal">i</code>這個變數了。這個程序用<code class="literal">gcc</code>編譯要加上選項<code class="literal">-std=c99</code>。這種語法也是從C++借鑒的，考慮到兼容性不建議使用這種寫法。</p><div class="footnotes"><br /><hr width="100" align="left" /><div class="footnote"><p><sup>[<a id="ftn.id2726856" href="#id2726856" class="para">9</a>] </sup>這兩種寫法在語義上稍有區別，詳見<a class="xref" href="ch16s02.html#op.compound">第 2.1 節 “復合賦值運算符”</a>。</p></div><div class="footnote"><p><sup>[<a id="ftn.id2726883" href="#id2726883" class="para">10</a>] </sup>increment和decrement這兩個詞很有意思，大多數字典都說它們是名詞，但經常被當成動詞用，在計算機術語中，它們當動詞用應該理解為increase by one和decrease by one。現代英語中很多原本是名詞的都被當成動詞用，字典都跟不上時代了，再比如transition也是如此。</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch06s02.html">上一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="ch06.html">上一級</a></td><td width="40%" align="right"> <a accesskey="n" href="ch06s04.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">2. do/while語句 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 4. break和continue語句</td></tr></table></div></body></html>
