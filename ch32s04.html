<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>4. awk</title><link rel="stylesheet" href="styles.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.73.2" /><link rel="start" href="index.html" title="Linux C編程一站式學習" /><link rel="up" href="ch32.html" title="第 32 章 正則表達式" /><link rel="prev" href="ch32s03.html" title="3. sed" /><link rel="next" href="ch32s05.html" title="5. 練習：在C語言中使用正則表達式" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4. awk</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch32s03.html">上一頁</a> </td><th width="60%" align="center">第 32 章 正則表達式</th><td width="20%" align="right"> <a accesskey="n" href="ch32s05.html">下一頁</a></td></tr></table><hr /></div><div class="sect1" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2880797"></a>4. awk</h2></div></div></div><p><code class="literal">sed</code>以行為單位處理檔案，<code class="literal">awk</code>比<code class="literal">sed</code>強的地方在於不僅能以行為單位還能以列為單位處理檔案。<code class="literal">awk</code>預設的行分隔符是換行，預設的列分隔符是連續的空格和Tab，但是行分隔符和列分隔符都可以自定義，比如<code class="literal">/etc/passwd</code>檔案的每一行有若干個欄位，欄位之間以<code class="literal">:</code>分隔，就可以重新定義<code class="literal">awk</code>的列分隔符為<code class="literal">:</code>並以列為單位處理這個檔案。<code class="literal">awk</code>實際上是一門很複雜的腳本語言，還有像C語言一樣的分支和循環結構，但是基本用法和<code class="literal">sed</code>類似，<code class="literal">awk</code>命令行的基本形式為：</p><pre class="programlisting">awk option 'script' file1 file2 ...
awk option -f scriptfile file1 file2 ...</pre><p>和<code class="literal">sed</code>一樣，<code class="literal">awk</code>處理的檔案既可以由標準輸入重定向得到，也可以當命令行參數傳入，編輯命令可以直接當命令行參數傳入，也可以用<code class="literal">-f</code>參數指定一個腳本檔案，編輯命令的格式為：</p><pre class="programlisting">/pattern/{actions}
condition{actions}</pre><p>和<code class="literal">sed</code>類似，<code class="literal">pattern</code>是正則表達式，<code class="literal">actions</code>是一系列操作。<code class="literal">awk</code>程序一行一行讀出待處理檔案，如果某一行與<code class="literal">pattern</code>匹配，或者滿足<code class="literal">condition</code>條件，則執行相應的<code class="literal">actions</code>，如果一條<code class="literal">awk</code>命令只有<code class="literal">actions</code>部分，則<code class="literal">actions</code>作用於待處理檔案的每一行。比如檔案<code class="literal">testfile</code>的內容表示某商店的庫存量：</p><pre class="programlisting">ProductA  30
ProductB  76
ProductC  55</pre><p>打印每一行的第二列:</p><pre class="screen">$ awk '{print $2;}' testfile
30
76
55</pre><p>自動變數<code class="literal">$1</code>、<code class="literal">$2</code>分別表示第一列、第二列等，類似於Shell腳本的位置參數，而<code class="literal">$0</code>表示整個當前行。再比如，如果某種產品的庫存量低於75則在行末標註需要訂貨：</p><pre class="programlisting">$ awk '$2&lt;75 {printf "%s\t%s\n", $0, "REORDER";} $2&gt;=75 {print $0;}' testfile
ProductA  30    REORDER
ProductB  76
ProductC  55    REORDER</pre><p>可見<code class="literal">awk</code>也有和C語言非常相似的<code class="literal">printf</code>函數。<code class="literal">awk</code>命令的<code class="literal">condition</code>部分還可以是兩個特殊的<code class="literal">condition</code>－<code class="literal">BEGIN</code>和<code class="literal">END</code>，對於每個待處理檔案，<code class="literal">BEGIN</code>後面的<code class="literal">actions</code>在處理整個檔案之前執行一次，<code class="literal">END</code>後面的<code class="literal">actions</code>在整個檔案處理完之後執行一次。</p><p><code class="literal">awk</code>命令可以像C語言一樣使用變數（但不需要定義變數），比如統計一個檔案中的空行數</p><pre class="screen">$ awk '/^ *$/ {x=x+1;} END {print x;}' testfile</pre><p>就像Shell的環境變數一樣，有些<code class="literal">awk</code>變數是預定義的有特殊含義的：</p><div class="table"><a id="id2881116"></a><p class="title"><b>表 32.6. awk常用的內建變數</b></p><div class="table-contents"><table summary="awk常用的內建變數" border="1"><colgroup><col /><col /></colgroup><tbody><tr><td>FILENAME</td><td>當前輸入檔案的檔案名，該變數是隻讀的</td></tr><tr><td>NR</td><td>當前行的行號，該變數是隻讀的，<code class="literal">R</code>代表record</td></tr><tr><td>NF</td><td>當前行所擁有的列數，該變數是隻讀的，<code class="literal">F</code>代表field</td></tr><tr><td>OFS</td><td>輸出格式的列分隔符，預設是空格</td></tr><tr><td>FS</td><td>輸入檔案的列分融符，預設是連續的空格和Tab</td></tr><tr><td>ORS</td><td>輸出格式的行分隔符，預設是換行符</td></tr><tr><td>RS</td><td>輸入檔案的行分隔符，預設是換行符</td></tr></tbody></table></div></div><br class="table-break" /><p>例如打印系統中的用戶帳號列表</p><pre class="screen">$ awk 'BEGIN {FS=":"} {print $1;}' /etc/passwd</pre><p><code class="literal">awk</code>還可以像C語言一樣使用<code class="literal">if</code>/<code class="literal">else</code>、<code class="literal">while</code>、<code class="literal">for</code>控制結構，此處從略。</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch32s03.html">上一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="ch32.html">上一級</a></td><td width="40%" align="right"> <a accesskey="n" href="ch32s05.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">3. sed </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 5. 練習：在C語言中使用正則表達式</td></tr></table></div></body></html>
