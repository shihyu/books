<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>1. 綫程的概念</title><link rel="stylesheet" href="styles.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.73.2" /><link rel="start" href="index.html" title="Linux C編程一站式學習" /><link rel="up" href="ch35.html" title="第 35 章 綫程" /><link rel="prev" href="ch35.html" title="第 35 章 綫程" /><link rel="next" href="ch35s02.html" title="2. 綫程控制" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">1. 綫程的概念</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch35.html">上一頁</a> </td><th width="60%" align="center">第 35 章 綫程</th><td width="20%" align="right"> <a accesskey="n" href="ch35s02.html">下一頁</a></td></tr></table><hr /></div><div class="sect1" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2895482"></a>1. 綫程的概念</h2></div></div></div><p>我們知道，進程在各自獨立的地址空間中運行，進程之間共享數據需要用<code class="literal">mmap</code>或者進程間通信機制，本節我們學習如何在一個進程的地址空間中執行多個綫程。有些情況需要在一個進程中同時執行多個控制流程，這時候綫程就派上了用場，比如實現一個圖形界面的下載軟件，一方面需要和用戶交互，等待和處理用戶的滑鼠鍵盤事件，另一方面又需要同時下載多個檔案，等待和處理從多個網絡主機發來的數據，這些任務都需要一個“<span class="quote">等待-處理</span>”的循環，可以用多綫程實現，一個綫程專門負責與用戶交互，另外幾個綫程每個綫程負責和一個網絡主機通信。</p><p>以前我們講過，<code class="literal">main</code>函數和信號處理函數是同一個進程地址空間中的多個控制流程，多綫程也是如此，但是比信號處理函數更加靈活，信號處理函數的控制流程只是在信號遞達時產生，在處理完信號之後就結束，而多綫程的控制流程可以長期並存，操作系統會在各綫程之間調度和切換，就像在多個進程之間調度和切換一樣。由於同一進程的多個綫程共享同一地址空間，因此Text Segment、Data Segment都是共享的，如果定義一個函數，在各綫程中都可以調用，如果定義一個全局變數，在各綫程中都可以訪問到，除此之外，各綫程還共享以下進程資源和環境：</p><div class="itemizedlist"><ul type="disc"><li><p>檔案描述符表</p></li><li><p>每種信號的處理方式（<code class="literal">SIG_IGN</code>、<code class="literal">SIG_DFL</code>或者自定義的信號處理函數）</p></li><li><p>當前工作目錄</p></li><li><p>用戶id和組id</p></li></ul></div><p>但有些資源是每個綫程各有一份的：</p><div class="itemizedlist"><ul type="disc"><li><p>綫程id</p></li><li><p>上下文，包括各種寄存器的值、程序計數器和棧指針</p></li><li><p>棧空間</p></li><li><p><code class="literal">errno</code>變數</p></li><li><p>信號屏蔽字</p></li><li><p>調度優先順序</p></li></ul></div><p>我們將要學習的綫程庫函數是由POSIX標準定義的，稱為POSIX thread或者pthread。在Linux上線程函數位于<code class="literal">libpthread</code>共享庫中，因此在編譯時要加上<code class="literal">-lpthread</code>選項。</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch35.html">上一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="ch35.html">上一級</a></td><td width="40%" align="right"> <a accesskey="n" href="ch35s02.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">第 35 章 綫程 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 2. 綫程控制</td></tr></table></div></body></html>
