<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>4. 指針與const限定符</title><link rel="stylesheet" href="styles.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.73.2" /><link rel="start" href="index.html" title="Linux C編程一站式學習" /><link rel="up" href="ch23.html" title="第 23 章 指針" /><link rel="prev" href="ch23s03.html" title="3. 指針與數組" /><link rel="next" href="ch23s05.html" title="5. 指針與結構體" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4. 指針與<code class="literal">const</code>限定符</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch23s03.html">上一頁</a> </td><th width="60%" align="center">第 23 章 指針</th><td width="20%" align="right"> <a accesskey="n" href="ch23s05.html">下一頁</a></td></tr></table><hr /></div><div class="sect1" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2812089"></a>4. 指針與<code class="literal">const</code>限定符</h2></div></div></div><p><code class="literal">const</code>限定符和指針結合起來常見的情況有以下幾種。</p><pre class="programlisting">const int *a;
int const *a;</pre><p>這兩種寫法是一樣的，<code class="literal">a</code>是一個指向<code class="literal">const int</code>型的指針，<code class="literal">a</code>所指向的內存單元不可改寫，所以<code class="literal">(*a)++</code>是不允許的，但<code class="literal">a</code>可以改寫，所以<code class="literal">a++</code>是允許的。</p><pre class="programlisting">int * const a;</pre><p><code class="literal">a</code>是一個指向<code class="literal">int</code>型的<code class="literal">const</code>指針，<code class="literal">*a</code>是可以改寫的，但<code class="literal">a</code>不允許改寫。</p><pre class="programlisting">int const * const a;</pre><p><code class="literal">a</code>是一個指向<code class="literal">const int</code>型的<code class="literal">const</code>指針，因此<code class="literal">*a</code>和<code class="literal">a</code>都不允許改寫。</p><p>指向非<code class="literal">const</code>變數的指針或者非<code class="literal">const</code>變數的地址可以傳給指向<code class="literal">const</code>變數的指針，編譯器可以做隱式類型轉換，例如：</p><pre class="programlisting">char c = 'a';
const char *pc = &amp;c;</pre><p>但是，指向<code class="literal">const</code>變數的指針或者<code class="literal">const</code>變數的地址不可以傳給指向非<code class="literal">const</code>變數的指針，以免透過後者意外改寫了前者所指向的內存單元，例如對下面的代碼編譯器會報警告：</p><pre class="programlisting">const char c = 'a';
char *pc = &amp;c;</pre><p>即使不用<code class="literal">const</code>限定符也能寫出功能正確的程序，但良好的編程習慣應該儘可能多地使用<code class="literal">const</code>，因為：</p><div class="orderedlist"><ol type="1"><li><p><code class="literal">const</code>給讀代碼的人傳達非常有用的信息。比如一個函數的參數是<code class="literal">const char *</code>，你在調用這個函數時就可以放心地傳給它<code class="literal">char *</code>或<code class="literal">const char *</code>指針，而不必擔心指針所指的內存單元被改寫。</p></li><li><p>儘可能多地使用<code class="literal">const</code>限定符，把不該變的都聲明成只讀，這樣可以依靠編譯器檢查程序中的Bug，防止意外改寫數據。</p></li><li><p><code class="literal">const</code>對編譯器優化是一個有用的提示，編譯器也許會把<code class="literal">const</code>變數優化成常量。</p></li></ol></div><p>在<a class="xref" href="ch19s03.html#asmc.layout">第 3 節 “變數的存儲佈局”</a>我們看到，字元串字面值通常分配在<code class="literal">.rodata</code>段，而在<a class="xref" href="ch08s04.html#array.string">第 4 節 “字元串”</a>提到，字元串字面值類似於數組名，做右值使用時自動轉換成指向首元素的指針，這種指針應該是<code class="literal">const char *</code>型。我們知道<code class="literal">printf</code>函數原型的第一個參數是<code class="literal">const char *</code>型，可以把<code class="literal">char *</code>或<code class="literal">const char *</code>指針傳給它，所以下面這些調用都是合法的：</p><pre class="programlisting">const char *p = "abcd";
const char str1[5] = "abcd";
char str2[5] = "abcd";
printf(p);
printf(str1);
printf(str2);
printf("abcd");</pre><p>注意上面第一行，如果要定義一個指針指向字元串字面值，這個指針應該是<code class="literal">const char *</code>型，如果寫成<code class="literal">char *p = "abcd";</code>就不好了，有隱患，例如：</p><pre class="programlisting">int main(void)
{
	char *p = "abcd";
...
	*p = 'A';
...
}</pre><p><code class="literal">p</code>指向<code class="literal">.rodata</code>段，不允許改寫，但編譯器不會報錯，在運行時會出現段錯誤。</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch23s03.html">上一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="ch23.html">上一級</a></td><td width="40%" align="right"> <a accesskey="n" href="ch23s05.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">3. 指針與數組 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 5. 指針與結構體</td></tr></table></div></body></html>
