<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>2. 基本語法</title><link rel="stylesheet" href="styles.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.73.2" /><link rel="start" href="index.html" title="Linux C編程一站式學習" /><link rel="up" href="ch32.html" title="第 32 章 正則表達式" /><link rel="prev" href="ch32s01.html" title="1. 引言" /><link rel="next" href="ch32s03.html" title="3. sed" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">2. 基本語法</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch32s01.html">上一頁</a> </td><th width="60%" align="center">第 32 章 正則表達式</th><td width="20%" align="right"> <a accesskey="n" href="ch32s03.html">下一頁</a></td></tr></table><hr /></div><div class="sect1" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2879223"></a>2. 基本語法</h2></div></div></div><p>我們知道C的變數和Shell腳本變數的定義和使用方法很不相同，表達能力也不相同，C的變數有各種類型，而Shell腳本變數都是字元串。同樣道理，各種工具和編程語言所使用的正則表達式規範的語法並不相同，表達能力也各不相同，有的正則表達式規範引入很多擴展，能表達更複雜的模式，但各種正則表達式規範的基本概念都是相通的。本節介紹<code class="literal">egrep(1)</code>所使用的正則表達式，它大致上符合POSIX正則表達式規範，詳見<code class="literal">regex(7)</code>（看這個man page對你的英文絶對是很好的鍛鍊）。希望讀者仿照上一節的例子，一邊學習語法，一邊用<code class="literal">egrep</code>命令做實驗。</p><div class="table"><a id="id2879268"></a><p class="title"><b>表 32.1. 字元類</b></p><div class="table-contents"><table summary="字元類" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>字元</th><th>含義</th><th>舉例</th></tr></thead><tbody><tr><td><code class="literal">.</code></td><td>匹配任意一個字元</td><td><code class="literal">abc.</code>可以匹配<code class="literal">abcd</code>、<code class="literal">abc9</code>等</td></tr><tr><td><code class="literal">[]</code></td><td>匹配括號中的任意一個字元</td><td><code class="literal">[abc]d</code>可以匹配<code class="literal">ad</code>、<code class="literal">bd</code>或<code class="literal">cd</code></td></tr><tr><td><code class="literal">-</code></td><td>在<code class="literal">[]</code>括號內表示字元範圍</td><td><code class="literal">[0-9a-fA-F]</code><code class="literal"></code>可以匹配一位十六進制數字</td></tr><tr><td><code class="literal">^</code></td><td>位於<code class="literal">[]</code>括號內的開頭，匹配除括號中的字元之外的任意一個字元</td><td><code class="literal">[^xy]</code>匹配除<code class="literal">xy</code>之外的任一字元，因此<code class="literal">[^xy]1</code>可以匹配<code class="literal">a1</code>、<code class="literal">b1</code>但不匹配<code class="literal">x1</code>、<code class="literal">y1</code></td></tr><tr><td><code class="literal">[[:xxx:]]</code></td><td><code class="literal">grep</code>工具預定義的一些命名字元類</td><td><code class="literal">[[:alpha:]]</code>匹配一個字母，<code class="literal">[[:digit:]]</code>匹配一個數字</td></tr></tbody></table></div></div><br class="table-break" /><div class="table"><a id="id2879472"></a><p class="title"><b>表 32.2. 數量限定符</b></p><div class="table-contents"><table summary="數量限定符" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>字元</th><th>含義</th><th>舉例</th></tr></thead><tbody><tr><td><code class="literal">?</code></td><td>緊跟在它前面的單元應匹配零次或一次</td><td><code class="literal">[0-9]?\.[0-9]</code>匹配<code class="literal">0.0</code>、<code class="literal">2.3</code>、<code class="literal">.5</code>等，由於<code class="literal">.</code>在正則表達式中是一個特殊字元，所以需要用<code class="literal">\</code>轉義一下，取字面值</td></tr><tr><td><code class="literal">+</code></td><td>緊跟在它前面的單元應匹配一次或多次</td><td><code class="literal">[a-zA-Z0-9_.-]+@[a-zA-Z0-9_.-]+\.[a-zA-Z0-9_.-]+</code>匹配email地址</td></tr><tr><td><code class="literal">*</code></td><td>緊跟在它前面的單元應匹配零次或多次</td><td><code class="literal">[0-9][0-9]*</code>匹配至少一位數字，等價于<code class="literal">[0-9]+</code>，<code class="literal">[a-zA-Z_]+[a-zA-Z_0-9]*</code>匹配C語言的標識符</td></tr><tr><td><code class="literal">{N}</code></td><td>緊跟在它前面的單元應精確匹配<code class="literal">N次</code></td><td><code class="literal">[1-9][0-9]{2}</code>匹配從<code class="literal">100</code>到<code class="literal">999</code>的整數</td></tr><tr><td><code class="literal">{N,}</code></td><td>緊跟在它前面的單元應匹配至少<code class="literal">N</code>次</td><td><code class="literal">[1-9][0-9]{2,}</code>匹配三位以上（含三位）的整數</td></tr><tr><td><code class="literal">{,M}</code></td><td>緊跟在它前面的單元應匹配最多<code class="literal">M</code>次</td><td><code class="literal">[0-9]{,1}</code>相當於<code class="literal">[0-9]?</code></td></tr><tr><td><code class="literal">{N,M}</code></td><td>緊跟在它前面的單元應匹配至少<code class="literal">N</code>次，最多<code class="literal">M</code>次</td><td><code class="literal">[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}</code>匹配IP地址</td></tr></tbody></table></div></div><br class="table-break" /><p>再次注意<code class="literal">grep</code>找的是包含某一模式的行，而不是完全匹配某一模式的行。再舉個例子，如果文本檔案的內容是</p><pre class="programlisting">aaabc
aad
efg</pre><p>查找<code class="literal">a*</code>這個模式的結果是三行都被找出來了</p><pre class="screen">$ egrep 'a*' testfile 
aabc
aad
efg</pre><p><code class="literal">a*</code>匹配0個或多個<code class="literal">a</code>，而第三行包含0個<code class="literal">a</code>，所以也包含了這一模式。單獨用<code class="literal">a*</code>這樣的正則表達式做查找沒什麼意義，一般是把<code class="literal">a*</code>作為正則表達式的一部分來用。</p><div class="table"><a id="id2879776"></a><p class="title"><b>表 32.3. 位置限定符</b></p><div class="table-contents"><table summary="位置限定符" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>字元</th><th>含義</th><th>舉例</th></tr></thead><tbody><tr><td><code class="literal">^</code></td><td>匹配行首的位置</td><td><code class="literal">^Content</code>匹配位於一行開頭的<code class="literal">Content</code></td></tr><tr><td><code class="literal">$</code></td><td>匹配行末的位置</td><td><code class="literal">;$</code>匹配位於一行結尾的<code class="literal">;</code>號，<code class="literal">^$</code>匹配空行</td></tr><tr><td><code class="literal">\&lt;</code></td><td>匹配單詞開頭的位置</td><td><code class="literal">\&lt;th</code>匹配<code class="literal">... this</code>，但不匹配<code class="literal">ethernet</code>、<code class="literal">tenth</code></td></tr><tr><td><code class="literal">\&gt;</code></td><td>匹配單詞結尾的位置</td><td><code class="literal">p\&gt;</code>匹配<code class="literal">leap ...</code>，但不匹配<code class="literal">parent</code>、<code class="literal">sleepy</code></td></tr><tr><td><code class="literal">\b</code></td><td>匹配單詞開頭或結尾的位置</td><td><code class="literal">\bat\b</code>匹配<code class="literal">... at ...</code>，但不匹配<code class="literal">cat</code>、<code class="literal">atexit</code>、<code class="literal">batch</code></td></tr><tr><td><code class="literal">\B</code></td><td>匹配非單詞開頭和結尾的位置</td><td><code class="literal">\Bat\B</code>匹配<code class="literal">battery</code>，但不匹配<code class="literal">... attend</code>、<code class="literal">hat ...</code></td></tr></tbody></table></div></div><br class="table-break" /><p>位置限定符可以幫助<code class="literal">grep</code>更準確地查找，例如上一節我們用<code class="literal">[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}</code>查找IP地址，找到這兩行</p><pre class="screen">192.168.1.1
1234.234.04.5678</pre><p>如果用<code class="literal">^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$</code>查找，就可以把<code class="literal">1234.234.04.5678</code>這一行過濾掉了。</p><div class="table"><a id="id2880045"></a><p class="title"><b>表 32.4. 其它特殊字元</b></p><div class="table-contents"><table summary="其它特殊字元" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>字元</th><th>含義</th><th>舉例</th></tr></thead><tbody><tr><td><code class="literal">\</code></td><td>轉義字元，普通字元轉義為特殊字元，特殊字元轉義為普通字元</td><td>普通字元<code class="literal">&lt;</code>寫成<code class="literal">\&lt;</code>表示單詞開頭的位置，特殊字元<code class="literal">.</code>寫成<code class="literal">\.</code>以及<code class="literal">\</code>寫成<code class="literal">\\</code>就當作普通字元來匹配</td></tr><tr><td><code class="literal">()</code></td><td>將正則表達式的一部分括起來組成一個單元，可以對整個單元使用數量限定符</td><td><code class="literal">([0-9]{1,3}\.){3}[0-9]{1,3}</code>匹配IP地址</td></tr><tr><td><code class="literal">|</code></td><td>連接兩個子表達式，表示或的關係</td><td><code class="literal">n(o|either)</code>匹配<code class="literal">no</code>或<code class="literal">neither</code></td></tr></tbody></table></div></div><br class="table-break" /><p>以上介紹的是<code class="literal">grep</code>正則表達式的Extended規範，Basic規範也有這些語法，只是字元<code class="literal">?+{}|()</code>應解釋為普通字元，要表示上述特殊含義則需要加<code class="literal">\</code>轉義。如果用<code class="literal">grep</code>而不是<code class="literal">egrep</code>，並且不加<code class="literal">-E</code>參數，則應該遵照Basic規範來寫正則表達式。</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch32s01.html">上一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="ch32.html">上一級</a></td><td width="40%" align="right"> <a accesskey="n" href="ch32s03.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">1. 引言 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 3. sed</td></tr></table></div></body></html>
