<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>3. 指針與數組</title><link rel="stylesheet" href="styles.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.73.2" /><link rel="start" href="index.html" title="Linux C編程一站式學習" /><link rel="up" href="ch23.html" title="第 23 章 指針" /><link rel="prev" href="ch23s02.html" title="2. 指針類型的參數和返回值" /><link rel="next" href="ch23s04.html" title="4. 指針與const限定符" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">3. 指針與數組</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch23s02.html">上一頁</a> </td><th width="60%" align="center">第 23 章 指針</th><td width="20%" align="right"> <a accesskey="n" href="ch23s04.html">下一頁</a></td></tr></table><hr /></div><div class="sect1" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2811560"></a>3. 指針與數組</h2></div></div></div><p>先看個例子，有如下語句：</p><pre class="programlisting">int a[10];
int *pa = &amp;a[0];
pa++;</pre><p>首先指針<code class="literal">pa</code>指向<code class="literal">a[0]</code>的地址，注意尾碼運算符的優先順序高於單目運算符，所以是取<code class="literal">a[0]</code>的地址，而不是取<code class="literal">a</code>的地址。然後<code class="literal">pa++</code>讓<code class="literal">pa</code>指向下一個元素（也就是<code class="literal">a[1]</code>），由於<code class="literal">pa</code>是<code class="literal">int *</code>指針，一個<code class="literal">int</code>型元素占4個位元組，所以<code class="literal">pa++</code>使<code class="literal">pa</code>所指向的地址加4，注意不是加1。</p><p>下面畫圖理解。從前面的例子我們發現，地址的具體數值其實無關緊要，關鍵是要說明地址之間的關係（<code class="literal">a[1]</code>位於<code class="literal">a[0]</code>之後4個位元組處）以及指針與變數之間的關係（指針保存的是變數的地址），現在我們換一種畫法，省略地址的具體數值，用方框表示存儲空間，用箭頭表示指針和變數之間的關係。</p><div class="figure"><a id="id2811671"></a><p class="title"><b>圖 23.3. 指針與數組</b></p><div class="figure-contents"><div><img src="images/pointer.array.png" alt="指針與數組" /></div></div></div><br class="figure-break" /><p>既然指針可以用<code class="literal">++</code>運算符，當然也可以用<code class="literal">+</code>、<code class="literal">-</code>運算符，<code class="literal">pa+2</code>這個表達式也是有意義的，如上圖所示，<code class="literal">pa</code>指向<code class="literal">a[1]</code>，那麼<code class="literal">pa+2</code>指向a[3]。事實上，<code class="literal">E1[E2]</code>這種寫法和<code class="literal">(*((E1)+(E2)))</code>是等價的，<code class="literal">*(pa+2)</code>也可以寫成<code class="literal">pa[2]</code>，<code class="literal">pa</code>就像數組名一樣，其實數組名也沒有什麼特殊的，<code class="literal">a[2]</code>之所以能取數組的第2個元素，是因為它等價于<code class="literal">*(a+2)</code>，在<a class="xref" href="ch08s01.html#array.intro">第 1 節 “數組的基本概念”</a>講過數組名做右值時自動轉換成指向首元素的指針，所以<code class="literal">a[2]</code>和<code class="literal">pa[2]</code>本質上是一樣的，都是通過指針間接定址訪問元素。由於<code class="literal">(*((E1)+(E2)))</code>顯然可以寫成<code class="literal">(*((E2)+(E1)))</code>，所以<code class="literal">E1[E2]</code>也可以寫成<code class="literal">E2[E1]</code>，這意味着<code class="literal">2[a]</code>、<code class="literal">2[pa]</code>這種寫法也是對的，但一般不這麼寫。另外，由於<code class="literal">a</code>做右值使用時和<code class="literal">&amp;a[0]</code>是一個意思，所以<code class="literal">int *pa = &amp;a[0];</code>通常不這麼寫，而是寫成更簡潔的形式<code class="literal">int *pa = a;</code>。</p><p>在<a class="xref" href="ch08s01.html#array.intro">第 1 節 “數組的基本概念”</a>還講過C語言允許數組下標是負數，現在你該明白為什麼這樣規定了。在上面的例子中，表達式<code class="literal">pa[-1]</code>是合法的，它和<code class="literal">a[0]</code>表示同一個元素。</p><p>現在猜一下，兩個指針變數做比較運算（<code class="literal">&gt;</code>、<code class="literal">&gt;=</code>、<code class="literal">&lt;</code>、<code class="literal">&lt;=</code>、<code class="literal">==</code>、<code class="literal">!=</code>）表示什麼意義？兩個指針變數做減法運算又表示什麼意義？</p><p>根據什麼來猜？根據<a class="xref" href="ch03s03.html#func.paraarg">第 3 節 “形參和實參”</a>講過的Rule of Least Surprise原則。你理解了指針和常數加減的概念，再根據以往使用比較運算的經驗，就應該猜到<code class="literal">pa + 2 &gt; pa</code>，<code class="literal">pa - 1 == a</code>，所以指針之間的比較運算比的是地址，C語言正是這樣規定的，不過C語言的規定更為嚴謹，只有指向同一個數組中元素的指針之間相互比較才有意義，否則沒有意義。那麼兩個指針相減表示什麼？<code class="literal">pa - a</code>等於幾？因為<code class="literal">pa - 1 == a</code>，所以<code class="literal">pa - a</code>顯然應該等於1，指針相減表示兩個指針之間相差的元素個數，同樣只有指向同一個數組中元素的指針之間相減才有意義。兩個指針相加表示什麼？想不出來它能有什麼意義，因此C語言也規定兩個指針不能相加。假如C語言為指針相加也規定了一種意義，那就相當Surprise了，不符合一般的經驗。無論是設計編程語言還是設計函數介面或人機界面都是這個道理，應該儘可能讓用戶根據以往的經驗知識就能推斷出該系統的基本用法。</p><p>在取數組元素時用數組名和用指針的語法一樣，但如果把數組名做左值使用，和指針就有區別了。例如<code class="literal">pa++</code>是合法的，但<code class="literal">a++</code>就不合法，<code class="literal">pa = a + 1</code>是合法的，但<code class="literal">a = pa + 1</code>就不合法。數組名做右值時轉換成指向首元素的指針，但做左值仍然表示整個數組的存儲空間，而不是首元素的存儲空間，數組名做左值還有一點特殊之處，不支持<code class="literal">++</code>、賦值這些運算符，但支持取地址運算符<code class="literal">&amp;</code>，所以<code class="literal">&amp;a</code>是合法的，我們將在<a class="xref" href="ch23s07.html#pointer.array3">第 7 節 “指向數組的指針與多維數組”</a>介紹這種語法。</p><p>在函數原型中，如果參數是數組，則等價于參數是指針的形式，例如：</p><pre class="programlisting">void func(int a[10])
{
	...
}</pre><p>等價于：</p><pre class="programlisting">void func(int *a)
{
	...
}</pre><p>第一種形式方括號中的數字可以不寫，仍然是等價的：</p><pre class="programlisting">void func(int a[])
{
	...
}</pre><p>參數寫成指針形式還是數組形式對編譯器來說沒區別，都表示這個參數是指針，之所以規定兩種形式是為了給讀代碼的人提供有用的信息，如果這個參數指向一個元素，通常寫成指針的形式，如果這個參數指向一串元素中的首元素，則經常寫成數組的形式。</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch23s02.html">上一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="ch23.html">上一級</a></td><td width="40%" align="right"> <a accesskey="n" href="ch23s04.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">2. 指針類型的參數和返回值 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 4. 指針與<code class="literal">const</code>限定符</td></tr></table></div></body></html>
