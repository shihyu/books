<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>5. lseek</title><link rel="stylesheet" href="styles.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.73.2" /><link rel="start" href="index.html" title="Linux C編程一站式學習" /><link rel="up" href="ch28.html" title="第 28 章 檔案與I/O" /><link rel="prev" href="ch28s04.html" title="4. read/write" /><link rel="next" href="ch28s06.html" title="6. fcntl" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5. lseek</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch28s04.html">上一頁</a> </td><th width="60%" align="center">第 28 章 檔案與I/O</th><td width="20%" align="right"> <a accesskey="n" href="ch28s06.html">下一頁</a></td></tr></table><hr /></div><div class="sect1" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2852751"></a>5. lseek</h2></div></div></div><p>每個打開的檔案都記錄著當前讀寫位置，打開檔案時讀寫位置是0，表示檔案開頭，通常讀寫多少個位元組就會將讀寫位置往後移多少個位元組。但是有一個例外，如果以<code class="literal">O_APPEND</code>方式打開，每次寫操作都會在檔案末尾追加數據，然後將讀寫位置移到新的檔案末尾。<code class="literal">lseek</code>和標準I/O庫的<code class="literal">fseek</code>函數類似，可以移動當前讀寫位置（或者叫偏移量）。</p><pre class="programlisting">#include &lt;sys/types.h&gt;
#include &lt;unistd.h&gt;

off_t lseek(int fd, off_t offset, int whence);</pre><p>參數<code class="literal">offset</code>和<code class="literal">whence</code>的含義和<code class="literal">fseek</code>函數完全相同。只不過第一個參數換成了檔案描述符。和<code class="literal">fseek</code>一樣，偏移量允許超過檔案末尾，這種情況下對該檔案的下一次寫操作將延長檔案，中間空洞的部分讀出來都是0。</p><p>若<code class="literal">lseek</code>成功執行，則返回新的偏移量，因此可用以下方法確定一個打開檔案的當前偏移量：</p><pre class="programlisting">off_t currpos;
currpos = lseek(fd, 0, SEEK_CUR);</pre><p>這種方法也可用來確定檔案或設備是否可以設置偏移量，常規檔案都可以設置偏移量，而設備一般是不可以設置偏移量的。如果設備不支持<code class="literal">lseek</code>，則<code class="literal">lseek</code>返回-1，並將<code class="literal">errno</code>設置為<code class="literal">ESPIPE</code>。注意<code class="literal">fseek</code>和<code class="literal">lseek</code>在返回值上有細微的差別，<code class="literal">fseek</code>成功時返回0失敗時返回-1，要返回當前偏移量需調用<code class="literal">ftell</code>，而<code class="literal">lseek</code>成功時返回當前偏移量失敗時返回-1。</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch28s04.html">上一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="ch28.html">上一級</a></td><td width="40%" align="right"> <a accesskey="n" href="ch28s06.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">4. read/write </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 6. fcntl</td></tr></table></div></body></html>
