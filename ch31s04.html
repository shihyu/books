<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>4. bash啟動腳本</title><link rel="stylesheet" href="styles.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.73.2" /><link rel="start" href="index.html" title="Linux C編程一站式學習" /><link rel="up" href="ch31.html" title="第 31 章 Shell腳本" /><link rel="prev" href="ch31s03.html" title="3. Shell的基本語法" /><link rel="next" href="ch31s05.html" title="5. Shell腳本語法" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4. bash啟動腳本</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch31s03.html">上一頁</a> </td><th width="60%" align="center">第 31 章 Shell腳本</th><td width="20%" align="right"> <a accesskey="n" href="ch31s05.html">下一頁</a></td></tr></table><hr /></div><div class="sect1" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2873178"></a>4. bash啟動腳本</h2></div></div></div><p>啟動腳本是<code class="literal">bash</code>啟動時自動執行的腳本。用戶可以把一些環境變數的設置和<code class="literal">alias</code>、<code class="literal">umask</code>設置放在啟動腳本中，這樣每次啟動Shell時這些設置都自動生效。思考一下，<code class="literal">bash</code>在執行啟動腳本時是以<code class="literal">fork</code>子Shell方式執行的還是以<code class="literal">source</code>方式執行的？</p><p>啟動bash的方法不同，執行啟動腳本的步驟也不相同，具體可分為以下幾種情況。</p><div class="sect2" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a id="id2873231"></a>4.1. 作為交互登錄Shell啟動，或者使用--login參數啟動</h3></div></div></div><p>交互Shell是指用戶在提示符下輸命令的Shell而非執行腳本的Shell，登錄Shell就是在輸入用戶名和密碼登錄後得到的Shell，比如從字元終端登錄或者用<code class="literal">telnet</code>/<code class="literal">ssh</code>從遠程登錄，但是從圖形界面的窗口管理器登錄之後會顯示桌面而不會產生登錄Shell（也不會執行啟動腳本），在圖形界面下打開終端窗口得到的Shell也不是登錄Shell。</p><p>這樣啟動<code class="literal">bash</code>會自動執行以下腳本：</p><div class="orderedlist"><ol type="1"><li><p>首先執行<code class="literal">/etc/profile</code>，系統中每個用戶登錄時都要執行這個腳本，如果係統管理員希望某個設置對所有用戶都生效，可以寫在這個腳本裡</p></li><li><p>然後依次查找當前用戶主目錄的<code class="literal">~/.bash_profile</code>、<code class="literal">~/.bash_login</code>和<code class="literal">~/.profile</code>三個檔案，找到第一個存在並且可讀的檔案來執行，如果希望某個設置只對當前用戶生效，可以寫在這個腳本裡，由於這個腳本在<code class="literal">/etc/profile</code>之後執行，<code class="literal">/etc/profile</code>設置的一些環境變數的值在這個腳本中可以修改，也就是說，當前用戶的設置可以覆蓋（Override）<a id="id2873327" class="indexterm"></a>系統中全局的設置。<code class="literal">~/.profile</code>這個啟動腳本是<code class="literal">sh</code>規定的，<code class="literal">bash</code>規定首先查找以<code class="literal">~/.bash_</code>開頭的啟動腳本，如果沒有則執行<code class="literal">~/.profile</code>，是為了和<code class="literal">sh</code>保持一致。</p></li><li><p>順便一提，在退出登錄時會執行<code class="literal">~/.bash_logout</code>腳本（如果它存在的話）。</p></li></ol></div></div><div class="sect2" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a id="id2873387"></a>4.2. 以交互非登錄Shell啟動</h3></div></div></div><p>比如在圖形界面下開一個終端窗口，或者在登錄Shell提示符下再輸入<code class="literal">bash</code>命令，就得到一個交互非登錄的Shell，這種Shell在啟動時自動執行<code class="literal">~/.bashrc</code>腳本。</p><p>為了使登錄Shell也能自動執行<code class="literal">~/.bashrc</code>，通常在<code class="literal">~/.bash_profile</code>中調用<code class="literal">~/.bashrc</code>：</p><pre class="programlisting">if [ -f ~/.bashrc ]; then
    . ~/.bashrc
fi</pre><p>這幾行的意思是如果<code class="literal">~/.bashrc</code>檔案存在則<code class="literal">source</code>它。多數Linux發行版在創建帳戶時會自動創建<code class="literal">~/.bash_profile</code>和<code class="literal">~/.bashrc</code>腳本，<code class="literal">~/.bash_profile</code>中通常都有上面這幾行。所以，如果要在啟動腳本中做某些設置，使它在圖形終端窗口和字元終端的Shell中都起作用，最好就是在<code class="literal">~/.bashrc</code>中設置。</p><p>下面做一個實驗，在<code class="literal">~/.bashrc</code>檔案末尾添加一行（如果這個檔案不存在就創建它）：</p><pre class="programlisting">export PATH=$PATH:/home/akaedu</pre><p>然後關掉終端窗口重新打開，或者從字元終端<code class="literal">logout</code>之後重新登錄，現在主目錄下的程序應該可以直接輸程序名運行而不必輸入路徑了，例如：</p><pre class="screen">~$ a.out</pre><p>就可以了，而不必</p><pre class="screen">~$ ./a.out</pre><p>為什麼登錄Shell和非登錄Shell的啟動腳本要區分開呢？最初的設計是這樣考慮的，如果從字元終端或者遠程登錄，那麼登錄Shell是該用戶的所有其它進程的父進程，也是其它子Shell的父進程，所以環境變數在登錄Shell的啟動腳本裡設置一次就可以自動帶到其它非登錄Shell裡，而Shell的本地變數、函數、<code class="literal">alias</code>等設置沒有辦法帶到子Shell裡，需要每次啟動非登錄Shell時設置一遍，所以就需要有非登錄Shell的啟動腳本，所以一般來說在<code class="literal">~/.bash_profile</code>裡設置環境變數，在<code class="literal">~/.bashrc</code>裡設置本地變數、函數、<code class="literal">alias</code>等。如果你的Linux帶有圖形系統則不能這樣設置，由於從圖形界面的窗口管理器登錄並不會產生登錄Shell，所以環境變數也應該在<code class="literal">~/.bashrc</code>裡設置。
</p></div><div class="sect2" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a id="id2873571"></a>4.3. 非交互啟動</h3></div></div></div><p>為執行腳本而<code class="literal">fork</code>出來的子Shell是非交互Shell，啟動時執行的腳本檔案由環境變數<code class="literal">BASH_ENV</code>定義，相當於自動執行以下命令：</p><pre class="programlisting">if [ -n "$BASH_ENV" ]; then . "$BASH_ENV"; fi</pre><p>如果環境變數<code class="literal">BASH_ENV</code>的值不是空字元串，則把它的值當作啟動腳本的檔案名，<code class="literal">source</code>這個腳本。</p></div><div class="sect2" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a id="id2873616"></a>4.4. 以sh命令啟動</h3></div></div></div><p>如果以<code class="literal">sh</code>命令啟動<code class="literal">bash</code>，<code class="literal">bash</code>將模擬<code class="literal">sh</code>的行為，以<code class="literal">~/.bash_</code>開頭的那些啟動腳本就不認了。所以，如果作為交互登錄Shell啟動，或者使用--login參數啟動，則依次執行以下腳本：</p><div class="orderedlist"><ol type="1"><li><p><code class="literal">/etc/profile</code></p></li><li><p><code class="literal">~/.profile</code></p></li></ol></div><p>如果作為交互Shell啟動，相當於自動執行以下命令：</p><pre class="programlisting">if [ -n "$ENV" ]; then . "$ENV"; fi</pre><p>如果作為非交互Shell啟動，則不執行任何啟動腳本。通常我們寫的Shell腳本都以<code class="literal">#! /bin/sh</code>開頭，都屬於這種方式。</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch31s03.html">上一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="ch31.html">上一級</a></td><td width="40%" align="right"> <a accesskey="n" href="ch31s05.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">3. Shell的基本語法 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 5. Shell腳本語法</td></tr></table></div></body></html>
