<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>3. sed</title><link rel="stylesheet" href="styles.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.73.2" /><link rel="start" href="index.html" title="Linux C編程一站式學習" /><link rel="up" href="ch32.html" title="第 32 章 正則表達式" /><link rel="prev" href="ch32s02.html" title="2. 基本語法" /><link rel="next" href="ch32s04.html" title="4. awk" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">3. sed</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch32s02.html">上一頁</a> </td><th width="60%" align="center">第 32 章 正則表達式</th><td width="20%" align="right"> <a accesskey="n" href="ch32s04.html">下一頁</a></td></tr></table><hr /></div><div class="sect1" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2880212"></a>3. sed</h2></div></div></div><p><code class="literal">sed</code>意為流編輯器（Stream Editor）<a id="id2880224" class="indexterm"></a>，在Shell腳本和Makefile中作為過濾器使用非常普遍，也就是把前一個程序的輸出引入sed的輸入，經過一系列編輯命令轉換為另一種格式輸出。<code class="literal">sed</code>和<code class="literal">vi</code>都源於早期UNIX的<code class="literal">ed</code>工具，所以很多<code class="literal">sed</code>命令和<code class="literal">vi</code>的末行命令是相同的。</p><p><code class="literal">sed</code>命令行的基本格式為</p><pre class="programlisting">sed option 'script' file1 file2 ...
sed option -f scriptfile file1 file2 ...</pre><p><code class="literal">sed</code>處理的檔案既可以由標準輸入重定向得到，也可以當命令行參數傳入，命令行參數可以一次傳入多個檔案，<code class="literal">sed</code>會依次處理。<code class="literal">sed</code>的編輯命令可以直接當命令行參數傳入，也可以寫成一個腳本檔案然後用<code class="literal">-f</code>參數指定，編輯命令的格式為</p><pre class="programlisting">/pattern/action</pre><p>其中<code class="literal">pattern</code>是正則表達式，<code class="literal">action</code>是編輯操作。<code class="literal">sed</code>程序一行一行讀出待處理檔案，如果某一行與<code class="literal">pattern</code>匹配，則執行相應的<code class="literal">action</code>，如果一條命令沒有<code class="literal">pattern</code>而只有<code class="literal">action</code>，這個<code class="literal">action</code>將作用於待處理檔案的每一行。</p><div class="table"><a id="id2880365"></a><p class="title"><b>表 32.5. 常用的sed命令</b></p><div class="table-contents"><table summary="常用的sed命令" border="1"><colgroup><col /><col /></colgroup><tbody><tr><td><code class="literal">/pattern/p</code></td><td>打印匹配<code class="literal">pattern</code>的行</td></tr><tr><td><code class="literal">/pattern/d</code></td><td>刪除匹配<code class="literal">pattern</code>的行</td></tr><tr><td><code class="literal">/pattern/s/pattern1/pattern2/</code></td><td>查找符合<code class="literal">pattern</code>的行，將該行第一個匹配<code class="literal">pattern1</code>的字元串替換為<code class="literal">pattern2</code></td></tr><tr><td><code class="literal">/pattern/s/pattern1/pattern2/g</code></td><td>查找符合<code class="literal">pattern</code>的行，將該行所有匹配<code class="literal">pattern1</code>的字元串替換為<code class="literal">pattern2</code></td></tr></tbody></table></div></div><br class="table-break" /><p>使用<code class="literal">p</code>命令需要注意，<code class="literal">sed</code>是把待處理檔案的內容連同處理結果一起輸出到標準輸出的，因此<code class="literal">p</code>命令表示除了把檔案內容打印出來之外還額外打印一遍匹配<code class="literal">pattern</code>的行。比如一個檔案<code class="literal">testfile</code>的內容是</p><pre class="programlisting">123
abc
456</pre><p>打印其中包含<code class="literal">abc</code>的行</p><pre class="screen">$ sed '/abc/p' testfile
123
abc
abc
456</pre><p>要想只輸出處理結果，應加上<code class="literal">-n</code>選項，這種用法相當於<code class="literal">grep</code>命令</p><pre class="screen">$ sed -n '/abc/p' testfile
abc</pre><p>使用<code class="literal">d</code>命令就不需要<code class="literal">-n</code>參數了，比如刪除含有<code class="literal">abc</code>的行</p><pre class="screen">$ sed '/abc/d' testfile
123
456</pre><p>注意，<code class="literal">sed</code>命令不會修改原檔案，刪除命令只表示某些行不打印輸出，而不是從原檔案中刪去。</p><p>使用查找替換命令時，可以把匹配<code class="literal">pattern1</code>的字元串複製到<code class="literal">pattern2</code>中，比如：</p><pre class="screen">$ sed 's/bc/-&amp;-/' testfile
123
a-bc-
456</pre><p><code class="literal">pattern2</code>中的<code class="literal">&amp;</code>表示原檔案的當前行中與<code class="literal">pattern1</code>相匹配的字元串，再比如：</p><pre class="screen">$ sed 's/\([0-9]\)\([0-9]\)/-\1-~\2~/' testfile
-1-~2~3
abc
-4-~5~6</pre><p><code class="literal">pattern2</code>中的<code class="literal">\1</code>表示與<code class="literal">pattern1</code>的第一個<code class="literal">()</code>括號相匹配的內容，<code class="literal">\2</code>表示與<code class="literal">pattern1</code>的第二個<code class="literal">()</code>括號相匹配的內容。<code class="literal">sed</code>預設使用Basic正則表達式規範，如果指定了<code class="literal">-r</code>選項則使用Extended規範，那麼<code class="literal">()</code>括號就不必轉義了。</p><p>如果<code class="literal">testfile</code>的內容是</p><pre class="programlisting">&lt;html&gt;&lt;head&gt;&lt;title&gt;Hello World&lt;/title&gt;
&lt;body&gt;Welcome to the world of regexp!&lt;/body&gt;&lt;/html&gt;</pre><p>現在要去掉所有的HTML標籤，使輸出結果為</p><pre class="screen">Hello World
Welcome to the world of regexp!</pre><p>怎麼做呢？如果用下面的命令</p><pre class="screen">$ sed 's/&lt;.*&gt;//g' testfile


</pre><p>結果是兩個空行，把所有字元都過濾掉了。這是因為，正則表達式中的數量限定符會匹配儘可能長的字元串，這稱為貪心的（Greedy）<a id="id2880724" class="indexterm"></a><sup>[<a id="id2880730" href="#ftn.id2880730" class="footnote">39</a>]</sup>。比如<code class="literal">sed</code>在處理第一行時，<code class="literal">&lt;.*&gt;</code>匹配的並不是<code class="literal">&lt;html&gt;</code>或<code class="literal">&lt;head&gt;</code>這樣的標籤，而是</p><pre class="programlisting">&lt;html&gt;&lt;head&gt;&lt;title&gt;Hello World&lt;/title&gt;</pre><p>這樣一整行，因為這一行開頭是<code class="literal">&lt;</code>，中間是若干個任意字元，末尾是<code class="literal">&gt;</code>。那麼這條命令怎麼改才對呢？留給讀者思考。</p><div class="footnotes"><br /><hr width="100" align="left" /><div class="footnote"><p><sup>[<a id="ftn.id2880730" href="#id2880730" class="para">39</a>] </sup>有些正則表達式規範支持Non-greedy的數量限定符，匹配儘可能短的字元串，例如在Python中<code class="literal">*?</code>和<code class="literal">*</code>一樣表示0個或任意多個，但前者是Non-greedy的。</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch32s02.html">上一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="ch32.html">上一級</a></td><td width="40%" align="right"> <a accesskey="n" href="ch32s04.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">2. 基本語法 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 4. awk</td></tr></table></div></body></html>
