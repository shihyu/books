<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>1. 預處理的步驟</title><link rel="stylesheet" href="styles.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.73.2" /><link rel="start" href="index.html" title="Linux C編程一站式學習" /><link rel="up" href="ch21.html" title="第 21 章 預處理" /><link rel="prev" href="ch21.html" title="第 21 章 預處理" /><link rel="next" href="ch21s02.html" title="2. 宏定義" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">1. 預處理的步驟</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch21.html">上一頁</a> </td><th width="60%" align="center">第 21 章 預處理</th><td width="20%" align="right"> <a accesskey="n" href="ch21s02.html">下一頁</a></td></tr></table><hr /></div><div class="sect1" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2796242"></a>1. 預處理的步驟</h2></div></div></div><p>現在我們全面瞭解一下C編譯器做語法解析之前的預處理步驟：</p><p>1、把<a class="xref" href="ch02s02.html#expr.constant">第 2 節 “常量”</a>提到過的三連符替換成相應的單字元。</p><p>2、把用<code class="literal">\</code>字元續行的多行代碼接成一行。例如：</p><pre class="programlisting">#define STR "hello, "\
		"world"</pre><p>經過這個預處理步驟之後接成一行：</p><pre class="programlisting">#define STR "hello, "		"world"</pre><p>這種續行的寫法要求<code class="literal">\</code>後面緊跟換行，中間不能有其它空白字元。</p><p>3、把註釋（不管是單行註釋還是多行註釋）都替換成一個空格。</p><p>4、經過以上兩步之後去掉了一些換行，有的換行在續行過程中去掉了，有的換行在多行註釋之中，也隨着註釋一起去掉了，剩下的代碼行稱為邏輯代碼行。然後預處理器把邏輯代碼行劃分成Token和空白字元，這時的Token稱為預處理Token，包括標識符、整數常量、浮點數常量、字元常量、字元串、運算符和其它符號。繼續上面的例子，兩個原始碼行被接成一個邏輯代碼行，然後這個邏輯代碼行被劃分成Token和空白字元：<code class="literal">#</code>，<code class="literal">define</code>，空格，<code class="literal">STR</code>，空格，<code class="literal">"hello, "</code>，Tab，Tab，<code class="literal">"world"</code>。</p><p>5、在Token中識別出預處理指示，做相應的預處理動作，如果遇到<code class="literal">#include</code>預處理指示，則把相應的源檔案包含進來，並對源檔案做以上1-4步預處理。如果遇到宏定義則做宏展開。</p><p>我們早在<a class="xref" href="ch08s02.html#array.statistic">第 2 節 “數組應用實例：統計隨機數”</a>就認識了預處理指示這個概念，現在給出它的嚴格定義。一條預處理指示由一個邏輯代碼行組成，以<code class="literal">#</code>開頭，後面跟若干個預處理Token，在預處理指示中允許使用的空白字元只有空格和Tab。</p><p>6、找出字元常量或字元串中的轉義序列，用相應的位元組來替換它，比如把<code class="literal">\n</code>替換成位元組0x0a。</p><p>7、把相鄰的字元串連接起來。繼續上面的例子，如果代碼中有：</p><pre class="programlisting">printf(
	STR);</pre><p>經過第4步處理劃分成以下Token：<code class="literal">printf</code>，<code class="literal">(</code>，換行，Tab，<code class="literal">STR</code>，<code class="literal">)</code>，<code class="literal">;</code>，換行。經過第5步宏展開後變成以下Token：<code class="literal">printf</code>，<code class="literal">(</code>，換行，Tab，<code class="literal">"hello, "</code>，Tab，Tab，<code class="literal">"world"</code>，<code class="literal">)</code>，<code class="literal">;</code>，換行。然後把相鄰的字元串連接起來，變成以下Token：<code class="literal">printf</code>，<code class="literal">(</code>，換行，Tab，<code class="literal">"hello, world"</code>，<code class="literal">)</code>，<code class="literal">;</code>，換行。</p><p>8、經過以上處理之後，把空白字元丟掉，把Token交給C編譯器做語法解析，這時就不再是預處理Token，而稱為C Token了。這裡丟掉的空白字元包括空格、換行、水平Tab、垂直Tab、分頁符。繼續上面的例子，最後交給C編譯器做語法解析的Token是：<code class="literal">printf</code>，<code class="literal">(</code>，<code class="literal">"hello, world"</code>，<code class="literal">)</code>，<code class="literal">;</code>。注意，把一個預處理指示寫成多行要用<code class="literal">\</code>續行，因為根據定義，一條預處理指示只能由一個邏輯代碼行組成，而把C代碼寫成多行則不需要用<code class="literal">\</code>續行，因為換行在C代碼中只不過是一種空白字元，在做語法解析時所有空白字元都已經丟掉了。</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch21.html">上一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="ch21.html">上一級</a></td><td width="40%" align="right"> <a accesskey="n" href="ch21s02.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">第 21 章 預處理 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 2. 宏定義</td></tr></table></div></body></html>
