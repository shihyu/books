<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>3. 形參和實參</title><link rel="stylesheet" href="styles.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.73.2" /><link rel="start" href="index.html" title="Linux C編程一站式學習" /><link rel="up" href="ch03.html" title="第 3 章 簡單函數" /><link rel="prev" href="ch03s02.html" title="2. 自定義函數" /><link rel="next" href="ch03s04.html" title="4. 全局變數、局部變數和作用域" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">3. 形參和實參</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch03s02.html">上一頁</a> </td><th width="60%" align="center">第 3 章 簡單函數</th><td width="20%" align="right"> <a accesskey="n" href="ch03s04.html">下一頁</a></td></tr></table><hr /></div><div class="sect1" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2713785"></a>3. 形參和實參</h2></div></div></div><p>下面我們定義一個帶參數的函數，我們需要在函數定義中指明參數的個數和每個參數的類型，定義參數就像定義變數一樣，需要為每個參數指明類型，參數的命名也要遵循標識符命名規則。例如：</p><div class="example"><a id="id2713799"></a><p class="title"><b>例 3.4. 帶參數的自定義函數</b></p><div class="example-contents"><pre class="programlisting">#include &lt;stdio.h&gt;

void print_time(int hour, int minute)
{
	printf("%d:%d\n", hour, minute);
}

int main(void)
{
	print_time(23, 59);
	return 0;
}</pre></div></div><br class="example-break" /><p>需要注意的是，定義變數時可以把相同類型的變數列在一起，而定義參數卻不可以，例如下面這樣的定義是錯的：</p><pre class="programlisting">void print_time(int hour, minute)
{
	printf("%d:%d\n", hour, minute);
}</pre><p>學習C語言的人肯定都樂意看到這句話：“<span class="quote">變數是這樣定義的，參數也是這樣定義的，一模一樣</span>”，這意味着不用專門去記住參數應該怎麼定義了。誰也不願意看到這句話：“<span class="quote">定義變數可以這樣寫，而定義參數卻不可以</span>”。C語言的設計者也不希望自己設計的語法規則裡到處都是例外，一個容易被用戶接受的設計應該遵循最少例外原則（Rule of Least Surprise）<a id="id2713837" class="indexterm"></a>。其實關於參數的這條規定也不算十分例外，也是可以理解的，請讀者想想為什麼要這麼規定。學習編程語言不應該死記各種語法規定，如果能夠想清楚設計者這麼規定的原因（Rationale）<a id="id2713847" class="indexterm"></a>，不僅有助于記憶，而且會有更多收穫。本書在必要的地方會解釋一些Rationale，或者啟發讀者自己去思考，例如上一節在腳註中解釋了<code class="literal">void</code>關鍵字的Rationale。<a class="xref" href="bi01.html#bibli.rationale" title="Rationale for International Standard － Programming Languages － C">[<abbr class="abbrev">C99 Rationale</abbr>]</a>是隨C99標準一起發佈的，值得參考。</p><p>總的來說，C語言的設計是非常優美的，只要理解了少數基本概念和基本原則就可以根據組合規則寫出任意複雜的程序，很少有例外的規定說這樣組合是不允許的，或者那樣類推是錯誤的。相反，C++的設計就非常複雜，充滿了例外，全世界沒幾個人能把C++的所有規則都牢記於心，因而C++的設計一直飽受爭議，這個觀點在<a class="xref" href="bi01.html#bibli.taoup" title="The Art of UNIX Programming">[<abbr class="abbrev">UNIX編程藝術</abbr>]</a>中有詳細闡述。</p><p>在本書中，凡是提醒讀者注意的地方都是多少有些Surprise的地方，初學者如果按常理來想很可能要想錯，所以需要特別提醒一下。而初學者容易犯的另外一些錯誤，完全是因為沒有掌握好基本概念和基本原理，或者根本無視組合規則而全憑自己主觀臆斷所致，對這一類問題本書不會做特別的提醒，例如有的初學者看完<a class="xref" href="ch02.html#expr">第 2 章 <i>常量、變數和表達式</i></a>之後會這樣打印π的值：</p><pre class="programlisting">double pi=3.1416;
printf("pi\n");</pre><p>之所以會犯這種錯誤，一是不理解Literal的含義，二是自己想當然地把變數名組合到字元串裡去，而事實上根本沒有這條語法規則。如果連這樣的錯誤都需要在書上專門提醒，就好比提醒小孩吃飯一定要吃到嘴裡，不要吃到鼻子裡，更不要吃到耳朵裡一樣。</p><p>回到正題。我們調用<code class="literal">print_time(23, 59)</code>時，函數中的參數<code class="literal">hour</code>就代表<code class="literal">23</code>，參數<code class="literal">minute</code>就代表<code class="literal">59</code>。確切地說，當我們討論函數中的<code class="literal">hour</code>這個參數時，我們所說的“<span class="quote">參數</span>”是指形參（Parameter）<a id="id2713967" class="indexterm"></a>，當我們討論傳一個參數<code class="literal">23</code>給函數時，我們所說的“<span class="quote">參數</span>”是指實參（Argument）<a id="id2713984" class="indexterm"></a>，但我習慣都叫參數而不習慣總把形參、實參這兩個文縐縐的詞掛在嘴邊（事實上大多數人都不習慣），讀者可以根據上下文判斷我說的到底是形參還是實參。記住這條基本原理：<span class="emphasis"><em>形參相當於函數中定義的變數，調用函數傳遞參數的過程相當於定義形參變數並且用實參的值來初始化</em></span>。例如這樣調用：</p><pre class="programlisting">void print_time(int hour, int minute)
{
	printf("%d:%d\n", hour, minute);
}

int main(void)
{
	int h = 23, m = 59;
	print_time(h, m);
	return 0;
}</pre><p>相當於在函數<code class="literal">print_time</code>中執行了這樣一些語句：</p><pre class="programlisting">int hour = h;
int minute = m;
printf("%d:%d\n", hour, minute);</pre><p><code class="literal">main</code>函數的變數<code class="literal">h</code>和<code class="literal">print_time</code>函數的參數<code class="literal">hour</code>是兩個不同的變數，只不過它們的存儲空間中都保存了相同的值23，因為變數<code class="literal">h</code>的值賦給了參數<code class="literal">hour</code>。同理，變數<code class="literal">m</code>的值賦給了參數<code class="literal">minute</code>。C語言的這種傳遞參數的方式稱為Call by Value<a id="id2714067" class="indexterm"></a>。在調用函數時，每個參數都需要得到一個值，函數定義中有幾個形參，在調用時就要傳幾個實參，不能多也不能少，每個參數的類型也必須對應上。</p><p>肯定有讀者注意到了，為什麼我們每次調用<code class="literal">printf</code>傳的實參個數都不一樣呢？因為C語言規定了一種特殊的參數列表格式，用命令<code class="literal">man 3 printf</code>可以查看到<code class="literal">printf</code>函數的原型：</p><pre class="programlisting">int printf(const char *format, ...);</pre><p>第一個參數是<code class="literal">const char *</code>類型的，後面的...可以代表0個或任意多個參數，這些參數的類型也是不確定的，這稱為可變參數（Variable Argument）<a id="id2714114" class="indexterm"></a>，<a class="xref" href="ch24s06.html#interface.va">第 6 節 “可變參數”</a>將會詳細討論這種格式。總之，每個函數的原型都明確規定了返回值類型以及參數的類型和個數，即使像<code class="literal">printf</code>這樣規定為“<span class="quote">不確定</span>”也是一種明確的規定，調用函數時要嚴格遵守這些規定，有時候我們把函數叫做介面（Interface）<a id="id2714138" class="indexterm"></a>，調用函數就是使用這個介面，使用介面的前提是必須和介面保持一致。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Man Page</h3><p>Man Page是Linux開發最常用的參考手冊，由很多頁面組成，每個頁面描述一個主題，這些頁面被組織成若干個Section。FHS（Filesystem Hierarchy Standard）<a id="id2714160" class="indexterm"></a>標準規定了Man Page各Section的含義如下：</p><div class="table"><a id="id2714168"></a><p class="title"><b>表 3.1. Man Page的Section</b></p><div class="table-contents"><table summary="Man Page的Section" border="1"><colgroup><col /><col /></colgroup><thead><tr><th>Section</th><th>描述</th></tr></thead><tbody><tr><td>1</td><td>用戶命令，例如<code class="literal">ls(1)</code></td></tr><tr><td>2</td><td>系統調用，例如<code class="literal">_exit(2)</code></td></tr><tr><td>3</td><td>庫函數，例如<code class="literal">printf(3)</code></td></tr><tr><td>4</td><td>特殊檔案，例如<code class="literal">null(4)</code>描述了設備檔案<code class="literal">/dev/null</code>、<code class="literal">/dev/zero</code>的作用</td></tr><tr><td>5</td><td>系統配置檔案的格式，例如<code class="literal">passwd(5)</code>描述了系統配置檔案<code class="literal">/etc/passwd</code>的格式</td></tr><tr><td>6</td><td>遊戲</td></tr><tr><td>7</td><td>其它雜項，例如<code class="literal">bash-builtins(7)</code>描述了<code class="literal">bash</code>的各種內建命令</td></tr><tr><td>8</td><td>系統管理命令，例如<code class="literal">ifconfig(8)</code></td></tr></tbody></table></div></div><br class="table-break" /><p>注意區分用戶命令和系統管理命令，用戶命令通常位於<code class="literal">/bin</code>和<code class="literal">/usr/bin</code>目錄，系統管理命令通常位於<code class="literal">/sbin</code>和<code class="literal">/usr/sbin</code>目錄，一般用戶可以執行用戶命令，而執行系統管理命令經常需要<code class="literal">root</code>權限。系統調用和庫函數的區別將在<a class="xref" href="ch19s02.html#asmc.main">第 2 節 “<code class="literal">main</code>函數和啟動常式”</a>說明。</p><p>Man Page中有些頁面有重名，比如敲<code class="literal">man printf</code>命令看到的並不是C函數<code class="literal">printf</code>，而是位於第1個Section的系統命令<code class="literal">printf</code>，要查看位於第3個Section的<code class="literal">printf</code>函數應該敲<code class="literal">man 3 printf</code>，也可以敲<code class="literal">man -k printf</code>命令搜索哪些頁面的主題包含<code class="literal">printf</code>關鍵字。本書會經常出現類似<code class="literal">printf(3)</code>這樣的寫法，括號中的3表示Man Page的第3個Section，或者表示“<span class="quote">我這裡想說的是<code class="literal">printf</code>庫函數而不是<code class="literal">printf</code>命令</span>”。</p></div><div class="simplesect" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h3 class="title"><a id="id2714399"></a>習題</h3></div></div></div><p>1、定義一個函數<code class="literal">increment</code>，它的作用是把傳進來的參數加1。例如：</p><pre class="programlisting">void increment(int x)
{
	x = x + 1;
}

int main(void)
{
	int i = 1, j = 2;
	increment(i); /* i now becomes 2 */
	increment(j); /* j now becomes 3 */
	return 0;
}</pre><p>我們在<code class="literal">main</code>函數中調用<code class="literal">increment</code>增加變數<code class="literal">i</code>和<code class="literal">j</code>的值，這樣能奏效嗎？為什麼？</p><p>2、如果在一個程序中調用了<code class="literal">printf</code>函數卻不包含標頭檔，例如<code class="literal">int main(void) { printf("\n"); }</code>，編譯時會報警告：<code class="literal">warning: incompatible implicit declaration of built-in function ‘printf’</code>。請分析錯誤原因。</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch03s02.html">上一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="ch03.html">上一級</a></td><td width="40%" align="right"> <a accesskey="n" href="ch03s04.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">2. 自定義函數 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 4. 全局變數、局部變數和作用域</td></tr></table></div></body></html>
