<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>4. 字元串</title><link rel="stylesheet" href="styles.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.73.2" /><link rel="start" href="index.html" title="Linux C編程一站式學習" /><link rel="up" href="ch08.html" title="第 8 章 數組" /><link rel="prev" href="ch08s03.html" title="3. 數組應用實例：直方圖" /><link rel="next" href="ch08s05.html" title="5. 多維數組" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4. 字元串</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch08s03.html">上一頁</a> </td><th width="60%" align="center">第 8 章 數組</th><td width="20%" align="right"> <a accesskey="n" href="ch08s05.html">下一頁</a></td></tr></table><hr /></div><div class="sect1" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2734544"></a>4. 字元串</h2></div></div></div><p>之前我一直對字元串避而不談，不做詳細解釋，現在已經具備了必要的基礎知識，可以深入討論一下字元串了。字元串可以看作一個數組，它的每個元素是字元型的，例如字元串<code class="literal">"Hello, world.\n"</code>圖示如下：</p><div class="figure"><a id="id2734565"></a><p class="title"><b>圖 8.2. 字元串</b></p><div class="figure-contents"><div><img src="images/array.string.png" alt="字元串" /></div></div></div><br class="figure-break" /><p>注意每個字元末尾都有一個字元<code class="literal">'\0'</code>做結束符，這裡的<code class="literal">\0</code>是ASCII碼的八進製表示，也就是ASCII碼為0的Null字元，在C語言中這種字元串也稱為以零結尾的字元串（Null-terminated String）<a id="id2734595" class="indexterm"></a>。數組元素可以通過數組名加下標的方式訪問，而字元串字面值也可以像數組名一樣使用，可以加下標訪問其中的字元：</p><pre class="programlisting">char c = "Hello, world.\n"[0];</pre><p>但是通過下標修改其中的字元卻是不允許的：</p><pre class="programlisting">"Hello, world.\n"[0] = 'A';</pre><p>這行代碼會產生編譯錯誤，說字元串字面值是隻讀的，不允許修改。字元串字面值還有一點和數組名類似，做右值使用時自動轉換成指向首元素的指針，在<a class="xref" href="ch03s03.html#func.paraarg">第 3 節 “形參和實參”</a>我們看到<code class="literal">printf</code>原型的第一個參數是指針類型，而<code class="literal">printf("hello world")</code>其實就是傳一個指針參數給<code class="literal">printf</code>。</p><p>前面講過數組可以像結構體一樣初始化，如果是字元數組，也可以用一個字元串字面值來初始化：</p><pre class="programlisting">char str[10] = "Hello";</pre><p>相當於：</p><pre class="programlisting">char str[10] = { 'H', 'e', 'l', 'l', 'o', '\0' };</pre><p><code class="literal">str</code>的後四個元素沒有指定，自動初始化為0，即Null字元。注意，雖然字元串字面值<code class="literal">"Hello"</code>是隻讀的，但用它初始化的數組<code class="literal">str</code>卻是可讀可寫的。數組<code class="literal">str</code>中保存了一串字元，以<code class="literal">'\0'</code>結尾，也可以叫字元串。在本書中只要是以Null字元結尾的一串字元都叫字元串，不管是像<code class="literal">str</code>這樣的數組，還是像<code class="literal">"Hello"</code>這樣的字元串字面值。</p><p>如果用於初始化的字元串字面值比數組還長，比如：</p><pre class="programlisting">char str[10] = "Hello, world.\n";</pre><p>則數組<code class="literal">str</code>只包含字元串的前10個字元，不包含Null字元，這種情況編譯器會給出警告。如果要用一個字元串字面值準確地初始化一個字元數組，最好的辦法是不指定數組的長度，讓編譯器自己計算：</p><pre class="programlisting">char str[] = "Hello, world.\n";</pre><p>字元串字面值的長度包括Null字元在內一共15個字元，編譯器會確定數組<code class="literal">str</code>的長度為15。</p><p>有一種情況需要特別注意，如果用於初始化的字元串字面值比數組剛好長出一個Null字元的長度，比如：</p><pre class="programlisting">char str[14] = "Hello, world.\n";</pre><p>則數組<code class="literal">str</code>不包含Null字元，並且編譯器不會給出警告，<a class="xref" href="bi01.html#bibli.rationale" title="Rationale for International Standard － Programming Languages － C">[<abbr class="abbrev">C99 Rationale</abbr>]</a>說這樣規定是為程序員方便，以前的很多編譯器都是這樣實現的，不管它有理沒理，C標準既然這麼規定了我們也沒辦法，只能自己小心了。</p><p>補充一點，<code class="literal">printf</code>函數的格式化字元串中可以用<code class="literal">%s</code>表示字元串的占位符。在學字元數組以前，我們用<code class="literal">%s</code>沒什麼意義，因為</p><pre class="programlisting">printf("string: %s\n", "Hello");</pre><p>還不如寫成</p><pre class="programlisting">printf("string: Hello\n");</pre><p>但現在字元串可以保存在一個數組裡面，用<code class="literal">%s</code>來打印就很有必要了：</p><pre class="programlisting">printf("string: %s\n", str);</pre><p><code class="literal">printf</code>會從數組<code class="literal">str</code>的開頭一直打印到Null字元為止，Null字元本身是Non-printable字元，不打印。這其實是一個危險的信號：如果數組<code class="literal">str</code>中沒有Null字元，那麼<code class="literal">printf</code>函數就會訪問數組越界，後果可能會很詭異：有時候打印出亂碼，有時候看起來沒錯誤，有時候引起程序崩潰。</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch08s03.html">上一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="ch08.html">上一級</a></td><td width="40%" align="right"> <a accesskey="n" href="ch08s05.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">3. 數組應用實例：直方圖 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 5. 多維數組</td></tr></table></div></body></html>
