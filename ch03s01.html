<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>1. 數學函數</title><link rel="stylesheet" href="styles.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.73.2" /><link rel="start" href="index.html" title="Linux C編程一站式學習" /><link rel="up" href="ch03.html" title="第 3 章 簡單函數" /><link rel="prev" href="ch03.html" title="第 3 章 簡單函數" /><link rel="next" href="ch03s02.html" title="2. 自定義函數" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">1. 數學函數</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch03.html">上一頁</a> </td><th width="60%" align="center">第 3 章 簡單函數</th><td width="20%" align="right"> <a accesskey="n" href="ch03s02.html">下一頁</a></td></tr></table><hr /></div><div class="sect1" lang="zh-cn" xml:lang="zh-cn"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2712397"></a>1. 數學函數</h2></div></div></div><p>在數學中我們用過sin和ln這樣的函數，例如sin(π/2)=1，ln1=0等等，在C語言中也可以使用這些函數（ln函數在C標準庫中叫做<code class="literal">log</code>）：</p><div class="example"><a id="id2711787"></a><p class="title"><b>例 3.1. 在C語言中使用數學函數</b></p><div class="example-contents"><pre class="programlisting">#include &lt;math.h&gt;
#include &lt;stdio.h&gt;

int main(void)
{
	double pi = 3.1416;
	printf("sin(pi/2)=%f\nln1=%f\n", sin(pi/2), log(1.0));
	return 0;
}</pre></div></div><br class="example-break" /><p>編譯運行這個程序，結果如下：</p><pre class="screen">$ gcc main.c -lm
$ ./a.out
sin(pi/2)=1.000000
ln1=0.000000</pre><p>在數學中寫一個函數有時候可以省略括號，而C語言要求一定要加上括號，例如<code class="literal">log(1.0)</code>。在C語言的術語中，<code class="literal">1.0</code>是參數（Argument），<code class="literal">log</code>是函數（Function）<a id="id2712436" class="indexterm"></a>，<code class="literal">log(1.0)</code>是函數調用（Function Call）<a id="id2712449" class="indexterm"></a>。<code class="literal">sin(pi/2)</code>和<code class="literal">log(1.0)</code>這兩個函數調用在我們的<code class="literal">printf</code>語句中處于什麼位置呢？在上一章講過，這應該是寫表達式的位置。因此函數調用也是一種表達式，這個表達式由函數調用運算符（()括號）和兩個操作數組成，操作數<code class="literal">log</code>是一個函數名（Function Designator）<a id="id2712482" class="indexterm"></a>，它的類型是一種函數類型（Function Type）<a id="id2712489" class="indexterm"></a>，操作數<code class="literal">1.0</code>是<code class="literal">double</code>型的。<code class="literal">log(1.0)</code>這個表達式的值就是對數運算的結果，也是<code class="literal">double</code>型的，在C語言中函數調用表達式的值稱為函數的返回值（Return Value）<a id="id2712519" class="indexterm"></a>。總結一下我們新學的語法規則：</p><div class="literallayout"><p>表達式 → 函數名<br />
表達式 → 表達式(參數列表)<br />
參數列表 → 表達式, 表達式, ...</p></div><p>現在我們可以完全理解<code class="literal">printf</code>語句了：原來<code class="literal">printf</code>也是一個函數，上例中的<code class="literal">printf("sin(pi/2)=%f\nln1=%f\n", sin(pi/2), log(1.0))</code>是帶三個參數的函數調用，而函數調用也是一種表達式，因此<code class="literal">printf</code>語句也是表達式語句的一種。但是<code class="literal">printf</code>感覺不像一個數學函數，為什麼呢？因為像<code class="literal">log</code>這種函數，我們傳進去一個參數會得到一個返回值，我們調用<code class="literal">log</code>函數就是為了得到它的返回值，至于<code class="literal">printf</code>，我們並不關心它的返回值（事實上它也有返回值，表示實際打印的字元數），我們調用<code class="literal">printf</code>不是為了得到它的返回值，而是為了利用它所產生的副作用（Side Effect）<a id="id2712601" class="indexterm"></a>－－打印。<span class="emphasis"><em>C語言的函數可以有Side Effect，這一點是它和數學函數在概念上的根本區別</em></span>。</p><p>Side Effect這個概念也適用於運算符組成的表達式。比如<code class="literal">a + b</code>這個表達式也可以看成一個函數調用，把運算符<code class="literal">+</code>看作函數，它的兩個參數是<code class="literal">a</code>和<code class="literal">b</code>，返回值是兩個參數的和，傳入兩個參數，得到一個返回值，並沒有產生任何Side Effect。而賦值運算符是有Side Effect的，如果把<code class="literal">a = b</code>這個表達式看成函數調用，返回值就是所賦的值，既是<code class="literal">b</code>的值也是<code class="literal">a</code>的值，但除此之外還產生了Side Effect，就是變數<code class="literal">a</code>被改變了，改變計算機存儲單元裡的數據或者做輸入輸出操作都算Side Effect。</p><p>回想一下我們的學習過程，一開始我們說賦值是一種語句，後來學了表達式，我們說賦值語句是表達式語句的一種；一開始我們說<code class="literal">printf</code>是一種語句，現在學了函數，我們又說<code class="literal">printf</code>也是表達式語句的一種。隨着我們一步步的學習，把原來看似不同類型的語句統一成一種語句了。學習的過程總是這樣，初學者一開始接觸的很多概念從嚴格意義上說是錯的，但是很容易理解，隨着一步步學習，在理解原有概念的基礎上不斷糾正，不斷泛化（Generalize）<a id="id2712698" class="indexterm"></a>。比如一年級老師說小數不能減大數，其實這個概念是錯的，後來引入了負數就可以減了，後來引入了分數，原來的正數和負數的概念就泛化為整數，上初中學了無理數，原來的整數和分數的概念就泛化為有理數，再上高中學了複數，有理數和無理數的概念就泛化為實數。坦白說，到目前為止本書的很多說法都是不完全正確的，但這是學習理解的必經階段，到後面的章節都會逐步糾正的。</p><p>程序第一行的#號（Pound Sign，Number Sign或Hash Sign）<a id="id2712726" class="indexterm"></a>和<code class="literal">include</code>表示包含一個標頭檔（Header File）<a id="id2712740" class="indexterm"></a>，後面尖括號（Angel Bracket）<a id="id2712748" class="indexterm"></a>中就是檔案名（這些標頭檔通常位於<code class="literal">/usr/include</code>目錄下）。標頭檔中聲明了我們程序中使用的庫函數，根據先聲明後使用的原則，要使用<code class="literal">printf</code>函數必須包含<code class="literal">stdio.h</code>，要使用數學函數必須包含<code class="literal">math.h</code>，如果什麼庫函數都不使用就不必包含任何標頭檔，例如寫一個程序<code class="literal">int main(void){int a;a=2;return 0;}</code>，不需要包含標頭檔就可以編譯通過，當然這個程序什麼也做不了。</p><p>使用<code class="literal">math.h</code>中聲明的庫函數還有一點特殊之處，<code class="literal">gcc</code>命令行必須加<code class="literal">-lm</code>選項，因為數學函數位于<code class="literal">libm.so</code>庫檔案中（這些庫檔案通常位於<code class="literal">/lib</code>目錄下），<code class="literal">-lm</code>選項告訴編譯器，我們程序中用到的數學函數要到這個庫檔案裡找。本書用到的大部分庫函數（例如<code class="literal">printf</code>）位於<code class="literal">libc.so</code>庫檔案中，使用<code class="literal">libc.so</code>中的庫函數在編譯時不需要加<code class="literal">-lc</code>選項，當然加了也不算錯，因為這個選項是<code class="literal">gcc</code>的預設選項。關於標頭檔和庫函數目前理解這麼多就可以了，到<a class="xref" href="ch20.html#link">第 20 章 <i>連結詳解</i></a>再詳細解釋。</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">C標準庫和glibc</h3><p>C標準主要由兩部分組成，一部分描述C的語法，另一部分描述C標準庫。C標準庫定義了一組標準標頭檔，每個標頭檔中包含一些相關的函數、變數、類型聲明和宏定義。要在一個平台上支持C語言，不僅要實現C編譯器，還要實現C標準庫，這樣的實現才算符合C標準。不符合C標準的實現也是存在的，例如很多單片機的C語言開發工具中只有C編譯器而沒有完整的C標準庫。</p><p>在Linux平台上最廣泛使用的C函式館是<code class="literal">glibc</code>，其中包括C標準庫的實現，也包括本書第三部分介紹的所有系統函數。几乎所有C程序都要調用<code class="literal">glibc</code>的庫函數，所以<code class="literal">glibc</code>是Linux平台C程序運行的基礎。<code class="literal">glibc</code>提供一組標頭檔和一組庫檔案，最基本、最常用的C標準庫函數和系統函數在<code class="literal">libc.so</code>庫檔案中，几乎所有C程序的運行都依賴于<code class="literal">libc.so</code>，有些做數學計算的C程序依賴于<code class="literal">libm.so</code>，以後我們還會看到多綫程的C程序依賴于<code class="literal">libpthread.so</code>。以後我說<code class="literal">libc</code>時專指<code class="literal">libc.so</code>這個庫檔案，而說<code class="literal">glibc</code>時指的是<code class="literal">glibc</code>提供的所有庫檔案。</p><p><code class="literal">glibc</code>並不是Linux平台唯一的基礎C函式館，也有人在開發別的C函式館，比如適用於嵌入式系統的<code class="literal">uClibc</code>。</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch03.html">上一頁</a> </td><td width="20%" align="center"><a accesskey="u" href="ch03.html">上一級</a></td><td width="40%" align="right"> <a accesskey="n" href="ch03s02.html">下一頁</a></td></tr><tr><td width="40%" align="left" valign="top">第 3 章 簡單函數 </td><td width="20%" align="center"><a accesskey="h" href="index.html">起始頁</a></td><td width="40%" align="right" valign="top"> 2. 自定義函數</td></tr></table></div></body></html>
